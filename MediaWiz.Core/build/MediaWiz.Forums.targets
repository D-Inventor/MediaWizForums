<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <MediaWizForumsAppPluginsFilesPath>$(MSBuildThisFileDirectory)..\App_Plugins\MediaWizards\**\*.*</MediaWizForumsAppPluginsFilesPath>
      <MediaWizListViewFilesPath>$(MSBuildThisFileDirectory)..\App_Plugins\ForumListView\**\*.*</MediaWizListViewFilesPath>
        <MediaWizAssetsFilesPath>$(MSBuildThisFileDirectory)..\staticwebassets\**\*.*</MediaWizAssetsFilesPath>
      <MediaWizViewsPartial>$(MSBuildThisFileDirectory)..\Views\Partials\*.*</MediaWizViewsPartial>
    </PropertyGroup>

    <Target Name="CopyMediaWizForums" BeforeTargets="Build">
        <ItemGroup>
            <MediaWizForumsAppPluginFiles Include="$(MediaWizForumsAppPluginsFilesPath)" />
        </ItemGroup>
        <Message Text="Copying MediaWiz.Forums App_Plugins: $(MediaWizForumsAppPluginsFilesPath) - #@(MediaWizForumsAppPluginFiles->Count()) files" Importance="high" />
        <Copy SourceFiles="@(MediaWizForumsAppPluginFiles)" DestinationFiles="@(MediaWizForumsAppPluginFiles->'$(MSBuildProjectDirectory)\App_Plugins\MediaWizards\%(RecursiveDir)%(Filename)%(Extension)')" SkipUnchangedFiles="false" />
    </Target>
  <Target Name="CopyForumListView" BeforeTargets="Build">
    <ItemGroup>
      <MediaWizListViewFiles Include="$(MediaWizListViewFilesPath)" />
    </ItemGroup>
    <Message Text="Copying MediaWiz.Forums App_Plugins: $(MediaWizListViewFilesPath) - #@(MediaWizListViewFiles->Count()) files" Importance="high" />
    <Copy SourceFiles="@(MediaWizListViewFiles)" DestinationFiles="@(MediaWizListViewFiles->'$(MSBuildProjectDirectory)\App_Plugins\ForumListView\%(RecursiveDir)%(Filename)%(Extension)')" SkipUnchangedFiles="false" />
  </Target>

  <Target Name="CopyMediaWizForumPartials" BeforeTargets="Build">
    <ItemGroup>
      <MediaWizPartialsViews Include="$(MediaWizViewsPartial)" />
    </ItemGroup>
    <Message Text="Copying MediaWiz.Forums Partial Views: $(MediaWizViewsPartial) - #@(MediaWizPartialsViews->Count()) files" Importance="high" />
    <Copy SourceFiles="@(MediaWizPartialsViews)" DestinationFiles="@(MediaWizPartialsViews->'$(MSBuildProjectDirectory)\Views\Partials\%(RecursiveDir)%(Filename)%(Extension)')" SkipUnchangedFiles="true" 
          Condition="%(Filename)!='' AND (!Exists('$(MSBuildProjectDirectory)\Views\Partials\%(RecursiveDir)%(Filename)%(Extension)') OR $([System.DateTime]::Parse('%(ModifiedTime)').Ticks) &gt; $([System.IO.File]::GetLastWriteTime('$(MSBuildProjectDirectory)\Views\Partials\%(RecursiveDir)%(Filename)%(Extension)').Ticks))" />
  </Target>
    <Target Name="CopyMediaWizStaticAssets" BeforeTargets="Build">
      <ItemGroup>
        <MediaWizForumsAssetFiles Include="$(MediaWizAssetsFilesPath)" />
      </ItemGroup>
      <Message Text="Copying MediaWiz.Forums static web asset files: $(MediaWizAssetsFilesPath) - #@(MediaWizForumsAssetFiles->Count()) files" Importance="high" />
      <Copy SourceFiles="@(MediaWizForumsAssetFiles)" DestinationFiles="@(MediaWizForumsAssetFiles->'$(MSBuildProjectDirectory)\wwwroot\%(RecursiveDir)%(Filename)%(Extension)')" SkipUnchangedFiles="true" 
            Condition="%(Filename)!='' AND (!Exists('$(MSBuildProjectDirectory)\wwwroot\%(RecursiveDir)%(Filename)%(Extension)') OR $([System.DateTime]::Parse('%(ModifiedTime)').Ticks) &gt; $([System.IO.File]::GetLastWriteTime('$(MSBuildProjectDirectory)\wwwroot\%(RecursiveDir)%(Filename)%(Extension)').Ticks))"/>
    </Target>

    <Target Name="RemovePartialViews" BeforeTargets="Clean">
      <ItemGroup>
         <PartialViewDir Include="$(MSBuildProjectDirectory)\Views\Partials\Forums\"/>
      </ItemGroup>
      <Message Text="Remove Old PartialViews (now using ViewComponents)" Importance="high" />
      <RemoveDir Directories="@(PartialViewDir)" />
    </Target>

    <Target Name="ClearMediaWizForumsAssets" BeforeTargets="Clean">
        <ItemGroup>
            <MediaWizForumsDir Include="$(MSBuildProjectDirectory)\App_Plugins\MediaWizards\" />
        </ItemGroup>
        <Message Text="Clear old MediaWiz.Forums data" Importance="high" />
        <RemoveDir Directories="@(MediaWizForumsDir)" />
    </Target>
</Project>
