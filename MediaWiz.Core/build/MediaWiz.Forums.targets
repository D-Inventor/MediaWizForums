<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <MediaWizForumsAppPluginsFilesPath>$(MSBuildThisFileDirectory)..\App_Plugins\MediaWizards\**\*.*</MediaWizForumsAppPluginsFilesPath>
        <MediaWizAssetsFilesPath>$(MSBuildThisFileDirectory)..\staticwebassets\**\*.*</MediaWizAssetsFilesPath>
        <MediaWizViewsFilesPath>$(MSBuildThisFileDirectory)..\Views\*.*</MediaWizViewsFilesPath>
    </PropertyGroup>

    <Target Name="CopyMediaWizForums" BeforeTargets="Build">
        <ItemGroup>
            <MediaWizForumsAppPluginFiles Include="$(MediaWizForumsAppPluginsFilesPath)" />
        </ItemGroup>
        <Message Text="Copying MediaWiz.Forums App_Plugins: $(MediaWizForumsAppPluginsFilesPath) - #@(MediaWizForumsAppPluginFiles->Count()) files" Importance="high" />
        <Copy SourceFiles="@(MediaWizForumsAppPluginFiles)" DestinationFiles="@(MediaWizForumsAppPluginFiles->'$(MSBuildProjectDirectory)\App_Plugins\MediaWizards\%(RecursiveDir)%(Filename)%(Extension)')" SkipUnchangedFiles="false" />
    </Target>

    <Target Name="CopyMediaWizForumViews" BeforeTargets="Build">
      <ItemGroup>
        <MediaWizForumsViews Include="$(MediaWizViewsFilesPath)" />
      </ItemGroup>
      <Message Text="Copying MediaWiz.Forums Tempate Views: $(MediaWizViewsFilesPath) - #@(MediaWizForumsViews->Count()) files" Importance="high" />
      <Copy SourceFiles="@(MediaWizForumsViews)" DestinationFiles="@(MediaWizForumsViews->'$(MSBuildProjectDirectory)\Views\%(Filename)%(Extension)')" SkipUnchangedFiles="true" 
            Condition="%(Filename)!='' AND (!Exists('$(MSBuildProjectDirectory)\Views\%(Filename)%(Extension)') OR $([System.DateTime]::Parse('%(ModifiedTime)').Ticks) &gt; $([System.IO.File]::GetLastWriteTime('$(MSBuildProjectDirectory)\Views\%(Filename)%(Extension)').Ticks))" />
    </Target>

    <Target Name="CopyMediaWizStaticAssets" BeforeTargets="Build">
      <ItemGroup>
        <MediaWizForumsAssetFiles Include="$(MediaWizAssetsFilesPath)" />
      </ItemGroup>
      <Message Text="Copying MediaWiz.Forums static web asset files: $(MediaWizAssetsFilesPath) - #@(MediaWizForumsAssetFiles->Count()) files" Importance="high" />
      <Copy SourceFiles="@(MediaWizForumsAssetFiles)" DestinationFiles="@(MediaWizForumsAssetFiles->'$(MSBuildProjectDirectory)\wwwroot\%(RecursiveDir)%(Filename)%(Extension)')" SkipUnchangedFiles="true" 
            Condition="%(Filename)!='' AND (!Exists('$(MSBuildProjectDirectory)\wwwroot\%(RecursiveDir)%(Filename)%(Extension)') OR $([System.DateTime]::Parse('%(ModifiedTime)').Ticks) &gt; $([System.IO.File]::GetLastWriteTime('$(MSBuildProjectDirectory)\wwwroot\%(RecursiveDir)%(Filename)%(Extension)').Ticks))"/>
    </Target>

    <Target Name="RemovePartialViews" BeforeTargets="Clean">
      <ItemGroup>
         <PartialViewDir Include="$(MSBuildProjectDirectory)\Views\Partials\Forums\"/>
      </ItemGroup>
      <Message Text="Remove Old PartialViews (now using ViewComponents)" Importance="high" />
      <RemoveDir Directories="@(PartialViewDir)" />
    </Target>

    <Target Name="ClearMediaWizForumsAssets" BeforeTargets="Clean">
        <ItemGroup>
            <MediaWizForumsDir Include="$(MSBuildProjectDirectory)\App_Plugins\MediaWizards\" />
        </ItemGroup>
        <Message Text="Clear old MediaWiz.Forums data" Importance="high" />
        <RemoveDir Directories="@(MediaWizForumsDir)" />
    </Target>
</Project>
