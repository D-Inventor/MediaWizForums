@using Umbraco.Extensions
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage

@{
    Layout = "ForumMaster.cshtml";
}

@section ForumHeader{
    <meta name="robots" content="nofollow,noarchive" />
}
<div class="wiz-forum-info">
    <div class="page-header">
        <h3>@Model.Value("title")</h3>
    </div>
    <div class="forum-intro">
        @Html.Raw(Model.Value("message"))
    </div>
</div>
@await Component.InvokeAsync("ForumMembership",new {Template = "Register"})

@section ForumScripts
{
    <script type="text/javascript" src="/umbraco/surface/JavascriptSurface/LoadResources/?keys=Forums.CaptchaErrMsg"></script>

    <script type="text/javascript">
        $.fn.clearValidation = function(){var v = $(this).validate();$('[name]',this).each(function(){v.successList.push(this);v.showErrors();});v.resetForm();v.reset();};

        $(document).ready(function() {
            if ('@Model.Value("useCaptcha")' !== 'True') {
                $('#register-submit').show();
            }
        });
        $(document).on('click', "#btn-captcha", function (e) {

            e.preventDefault();
            MediaWiz.captchaCheck($("#Captcha").val(), function(data) {
                if (data) {
                    $("#captcha-check").hide();
                    $('#register-form-id').show();
                    $("#register-form-id").clearValidation(); 
                } else {
                    $("#Captcha").val("");
                    $("#Captcha").attr("placeholder", local.ForumsCaptchaErrMsg);
                }
            });
        });
        $(document).on("click","#captcha-refresh", function(e) {
            e.preventDefault();
            $.ajax({
                url: "/umbraco/surface/forumssurface/refreshcaptcha",
                success: function (data) {
                    $("#captchaimage-div").html(data);
                }
            });
        });
    </script>
}
